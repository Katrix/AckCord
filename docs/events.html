<!DOCTYPE html><html><head><title>AckCord: Events</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Katrix" /><meta name="description" content="A Discord library built for flexibility and speed" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="AckCord: Events" /><meta name="title" property="og:title" content="AckCord: Events" /><meta name="og:site_name" content="AckCord" /><meta name="og:url" content="http://ackcord.katsstuff.net" /><meta name="og:type" content="website" /><meta name="og:description" content="A Discord library built for flexibility and speed" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="AckCord: Events" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="A Discord library built for flexibility and speed" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/pattern-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>AckCord</span></div></a></li> <li><a href="/first_bot.html" class="">Your first bot</a></li> <li><a href="/docs/events.html" class=" active ">Events</a></li> <li><a href="/docs/cachesnapshot.html" class="">CacheSnapshot</a></li> <li><a href="/docs/requests.html" class="">Making Requests</a></li> <li><a href="/docs/commands.html" class="">Commands</a></li> <li><a href="/docs/snowflakes.html" class="">Snowflake types</a></li> <li><a href="/docs/low-level/index.html" class="">The low level API</a> <ul class="sub-section"> <li><a href="/docs/low-level/first_bot.html" class="">Your first bot (Low level)</a></li> <li><a href="/docs/low-level/requests.html" class="">Making Requests (Low level)</a></li></ul></li> <li><a href="/docs/advanced/index.html" class="">Expanding AckCord</a> <ul class="sub-section"> <li><a href="/docs/advanced/cache.html" class="">The cache (Advanced)</a></li> <li><a href="/docs/advanced/custom_request.html" class="">Custom requests (Advanced)</a></li> <li><a href="/docs/advanced/sound.html" class="">Sending custom sound (Advanced)</a></li> <li><a href="/docs/advanced/actionbuilders_deep.html" class="">ActionBuilder deep dive (Advanced)</a></li> <li><a href="/docs/advanced/commands_deep.html" class="">Commands deep dive (Advanced)</a></li></ul></li> <li><a href="/modules.html" class="">The many modules of AckCord</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/Katrix/AckCord" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/Katrix/AckCord" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="Katrix" data-github-repo="AckCord"><div class="content-wrapper"><section><h1 id="events">Events</h1>
<p>Whenever something happens in Discord, it sends an event to your client. This 
can for example be: someone sends, updates, or deletes a message, your bot joins 
a new guild, or someone creates a new channel.</p>

<p>There are two main ways to listen to these events. The first is through 
<code class="highlighter-rouge">DiscordClient#onEventSideEffects</code> and friends. We’ll use 
<code class="highlighter-rouge">DiscordClient#onEventSideEffectsIgnore</code> here, and go over the other forms in 
the next section.</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">client</span><span class="o">.</span><span class="py">onEventSideEffectsIgnore</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nv">APIMessage</span><span class="o">.</span><span class="py">MessageCreate</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">message</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">println</span><span class="o">(</span><span class="nv">message</span><span class="o">.</span><span class="py">content</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>There is nothing that decides where you have to start listening to an event. 
You can do it anywhere, even inside another listener.</p>

<p>The return type of this method call is <code class="highlighter-rouge">EventRegistration[Mat]</code>, but most of 
often just <code class="highlighter-rouge">EventRegistration[NotUsed]</code>. This value lets you know when an event 
listener stops, and a way to stop it.</p>

<p>The second way to listen for events is using an <code class="highlighter-rouge">EventsController</code>. If you’ve 
ever used controllers and actions in the Play framework, then the base idea is 
the same. To start you pick an event listener builder that best fits your need. 
Some examples are <code class="highlighter-rouge">Event</code>, <code class="highlighter-rouge">TextChannelEvent</code> and <code class="highlighter-rouge">GuildUserEvent</code>. Depending on 
which event you chose, it might contain some extra information surrounding the 
event. You then call <code class="highlighter-rouge">to</code> with the event type you are listening to. From there 
you call one of the methods on it that bests suits you need, 
like <code class="highlighter-rouge">withSideEffects</code>, <code class="highlighter-rouge">withRequest</code>, <code class="highlighter-rouge">async</code>, and so on.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyListeners</span><span class="o">(</span><span class="n">requests</span><span class="k">:</span> <span class="kt">Requests</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">EventsController</span><span class="o">(</span><span class="n">requests</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">onCreate</span> <span class="k">=</span> <span class="nv">TextChannelEvent</span><span class="o">.</span><span class="py">on</span><span class="o">[</span><span class="kt">APIMessage.MessageCreate</span><span class="o">].</span><span class="py">withSideEffects</span> <span class="o">{</span> <span class="n">m</span> <span class="k">=&gt;</span>
    <span class="nf">println</span><span class="o">(</span><span class="nv">m</span><span class="o">.</span><span class="py">event</span><span class="o">.</span><span class="py">message</span><span class="o">.</span><span class="py">content</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>These listeners also need to be registered. 
That can be done using <code class="highlighter-rouge">DiscordClient#registerListener</code>.</p>

<pre><code class="language-mdoc:silent">val myListeners = new MyListeners(client.requests)
client.registerListener(myListeners.onCreate)
</code></pre>

<p>Here is a small example that illustrates the fact that you can define and use 
your listeners anywhere. There is nothing special about them.</p>
<pre><code class="language-mdoc:silent">val MessageEvent: EventListenerBuilder[TextChannelEventListenerMessage, APIMessage.MessageCreate] =
  TextChannelEvent.on[APIMessage.MessageCreate]

val createListeners: EventListener[APIMessage.MessageCreate, NotUsed] =
  MessageEvent.withSideEffects { m =&gt;
    val startMessage = m.event.message

    if (startMessage.content.startsWith("start listen ")) {
      val inChannel  = m.channel.id
      val identifier = startMessage.content.replaceFirst("start listen ", "")

      val listener = client.registerListener(MessageEvent.withSideEffects { m =&gt;
        if (m.channel.id == inChannel) {
          println(s"$identifier: ${m.event.message.content}")
        }
      })

      //We need lazy and an explicit type here to make Scala happy
      lazy val stopper: EventRegistration[NotUsed] =
        client.registerListener(MessageEvent.withSideEffects { m =&gt;
          if (m.channel.id == inChannel &amp;&amp; m.event.message.content == "stop listen " + identifier) {
            listener.stop()
            stopper.stop()
          }
        })

      //Initialize stopper
      stopper
    }
  }
</code></pre>

<p>Note that there is no defined order for which event handler will receive an 
event first. If you register an event handler inside another event handler, it 
might or might not receive the event that caused its registration.</p>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/main.js"></script></body></html>